<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnos ICV 10x10</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #d32f2f; --whatsapp: #25d366; --bg: #f4f7f6; --card-bg: #ffffff; --text: #333; --border: #eee; }
        body.dark-mode { --bg: #121212; --card-bg: #1e1e1e; --text: #e0e0e0; --border: #333; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); margin: 0; display: flex; justify-content: center; padding: 10px; color: var(--text); transition: 0.3s; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; border-top: 8px solid var(--primary); }
        
        .profile-container { position: relative; width: 85px; height: 85px; margin: 0 auto 10px; }
        #profileDisplay { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 3px solid #ddd; background: #eee; }
        .photo-input { position: absolute; bottom: 0; right: 0; background: var(--primary); color: white; border-radius: 50%; width: 26px; height: 26px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white; font-size: 16px; font-weight: bold; }
        #file-input { display: none; }

        .logo-icv { max-width: 110px; margin-bottom: 5px; }
        .brand-name { font-weight: 800; font-size: 0.75rem; letter-spacing: 1px; margin-bottom: 20px; text-transform: uppercase; color: var(--primary); }
        
        .config-section { background: #f8f9fa; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid var(--border); text-align: left; }
        body.dark-mode .config-section { background: #252525; }
        
        label { font-size: 0.65rem; font-weight: 700; color: #777; display: block; margin-bottom: 5px; text-transform: uppercase; }
        select, input { width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 12px; font-size: 0.95rem; background: var(--card-bg); color: var(--text); margin-bottom: 12px; box-sizing: border-box; }
        
        .result-box { margin: 15px 0; padding: 20px; border-radius: 18px; font-weight: 800; font-size: 1.4rem; border: 3px solid transparent; }
        .widget { padding: 12px; background: var(--bg); border-radius: 12px; font-size: 0.8rem; font-weight: 600; margin-bottom: 10px; border-left: 5px solid var(--primary); text-align: left; }
        
        .mini-calendar { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 10px 0; }
        .day-box { padding: 10px; border-radius: 8px; font-size: 0.75rem; font-weight: bold; color: white; }
        
        .btn { border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-weight: 700; width: 100%; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; color: white; transition: 0.2s; text-decoration: none; }
        .btn-pdf { background-color: #333; } .btn-ws { background-color: var(--whatsapp); }

        .footer { margin-top: 15px; font-size: 0.65rem; color: #888; border-top: 1px solid var(--border); padding-top: 12px; }
    </style>
</head>
<body>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <img src="https://www.icv.cl/wp-content/uploads/2021/05/logo-icv.png" alt="ICV" class="logo-icv">
        <button onclick="document.body.classList.toggle('dark-mode')" style="background:none; border:none; cursor:pointer; font-size: 1.3rem;">ðŸŒ“</button>
    </div>
    
    <div class="profile-container">
        <img id="profileDisplay" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
        <label for="file-input" class="photo-input">+</label>
        <input type="file" id="file-input" accept="image/*" onchange="loadPhoto(event)">
    </div>

    <div class="brand-name">IngenierÃ­a Civil Vicente</div>

    <div class="config-section">
        <label>Grupo</label>
        <select id="grupo" onchange="saveData()">
            <option value="1">Grupo 1</option>
            <option value="2">Grupo 2</option>
            <option value="3">Grupo 3</option>
            <option value="4">Grupo 4</option>
            <option value="5">Grupo 5</option>
            <option value="6">Grupo 6</option>
            <option value="7">Grupo 7</option>
            <option value="8">Grupo 8</option>
        </select>

        <label>Primer dÃ­a de trabajo (DÃ­a 1)</label>
        <input type="date" id="fechaInicio" onchange="saveData()">
        
        <label>Nombre del Colaborador</label>
        <input type="text" id="nombre" placeholder="Nombre completo" oninput="saveData()">
    </div>

    <div style="text-align: left;">
        <label>Fecha a Consultar</label>
        <input type="date" id="fechaBusqueda" onchange="calcular()">
    </div>

    <div id="contadorBajada" class="widget">-</div>
    <div id="resultado" class="result-box"></div>

    <label>Ciclo de 10 dÃ­as:</label>
    <div class="mini-calendar" id="miniCalendar"></div>

    <button class="btn btn-pdf" onclick="descargarPDF()">ðŸ“„ Generar PDF</button>
    <button class="btn btn-ws" onclick="compartirWhatsApp()">ðŸ’¬ WhatsApp</button>

    <div class="footer">
        <strong>@Otherbabu.u 2025</strong> | ICV Faena
    </div>
</div>

<script>
    function loadPhoto(event) {
        const reader = new FileReader();
        reader.onload = () => {
            document.getElementById('profileDisplay').src = reader.result;
            localStorage.setItem('userPhoto', reader.result);
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    function saveData() {
        localStorage.setItem('grupoICV', document.getElementById('grupo').value);
        localStorage.setItem('inicioICV', document.getElementById('fechaInicio').value);
        localStorage.setItem('nombreICV', document.getElementById('nombre').value);
        calcular();
    }

    window.onload = function() {
        if(localStorage.getItem('userPhoto')) document.getElementById('profileDisplay').src = localStorage.getItem('userPhoto');
        if(localStorage.getItem('grupoICV')) document.getElementById('grupo').value = localStorage.getItem('grupoICV');
        if(localStorage.getItem('inicioICV')) document.getElementById('fechaInicio').value = localStorage.getItem('inicioICV');
        if(localStorage.getItem('nombreICV')) document.getElementById('nombre').value = localStorage.getItem('nombreICV');
        
        document.getElementById('fechaBusqueda').value = new Date().toISOString().split('T')[0];
        calcular();
    };

    function calcular() {
        const fInicioStr = document.getElementById('fechaInicio').value;
        const fBuscaStr = document.getElementById('fechaBusqueda').value;
        const grupo = document.getElementById('grupo').value;
        
        if (!fInicioStr || !fBuscaStr) return;

        const inicio = new Date(fInicioStr + "T12:00:00");
        const busca = new Date(fBuscaStr + "T12:00:00");
        const diff = Math.floor((busca - inicio) / (1000*60*60*24));
        
        const sistema = 10;
        // Grupos 5, 6, 7 y 8 configurados como 10x10 Solo DÃ­a (Ciclo de 20 dÃ­as)
        const cicloTotal = (parseInt(grupo) >= 5) ? 20 : 40;
        
        let pos = diff % cicloTotal;
        if (pos < 0) pos += cicloTotal;

        const resDiv = document.getElementById('resultado');
        const cont = document.getElementById('contadorBajada');

        if (cicloTotal === 20) {
            if (pos < 10) {
                actualizarUI("TURNO DÃA â˜€ï¸", "#fff3e0", "#ef6c00", "#ff9800");
                cont.innerText = `Bajas en: ${10 - pos} dÃ­as`;
            } else {
                actualizarUI("DÃA LIBRE ðŸ ", "#e8f5e9", "#2e7d32", "#4caf50");
                cont.innerText = `Subes en: ${20 - pos} dÃ­as`;
            }
        } else {
            if (pos < 10) {
                actualizarUI("TURNO DÃA â˜€ï¸", "#fff3e0", "#ef6c00", "#ff9800");
                cont.innerText = `Bajas en: ${10 - pos} dÃ­as`;
            } else if (pos < 20) {
                actualizarUI("DÃA LIBRE ðŸ ", "#e8f5e9", "#2e7d32", "#4caf50");
                cont.innerText = `Subes a NOCHE en: ${20 - pos} dÃ­as`;
            } else if (pos < 30) {
                actualizarUI("TURNO NOCHE ðŸŒ™", "#e8eaf6", "#283593", "#3f51b5");
                cont.innerText = `Bajas en: ${30 - pos} dÃ­as`;
            } else {
                actualizarUI("DÃA LIBRE ðŸ ", "#e8f5e9", "#2e7d32", "#4caf50");
                cont.innerText = `Subes a DÃA en: ${40 - pos} dÃ­as`;
            }
        }

        const miniCal = document.getElementById('miniCalendar');
        miniCal.innerHTML = "";
        let inicioBloque = Math.floor(pos / 10) * 10;
        for (let i = 0; i < 10; i++) {
            const p = (inicioBloque + i) % cicloTotal;
            const d = document.createElement('div');
            d.className = "day-box"; d.innerText = i+1;
            if (p < 10) d.style.backgroundColor = "#ff9800";
            else if (p < 20) d.style.backgroundColor = "#4caf50";
            else if (p < 30) d.style.backgroundColor = "#3f51b5";
            else d.style.backgroundColor = "#4caf50";
            if ((inicioBloque + i) === pos) d.style.border = "3px solid #333";
            miniCal.appendChild(d);
        }
    }

    function actualizarUI(t, b, c, br) { const r = document.getElementById('resultado'); r.innerText = t; r.style.backgroundColor = b; r.style.color = c; r.style.borderColor = br; }
    
    function descargarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("REPORTE ICV - GRUPO " + document.getElementById('grupo').value, 20, 20);
        doc.text("Colaborador: " + document.getElementById('nombre').value, 20, 35);
        doc.text("Estado: " + document.getElementById('resultado').innerText, 20, 50);
        doc.save("Turno_ICV.pdf");
    }

    function compartirWhatsApp() {
        const msj = encodeURIComponent(`*TURNO ICV*\nðŸ‘¤ *${document.getElementById('nombre').value}*\nðŸ“ Estado: *${document.getElementById('resultado').innerText}*`);
        window.open(`https://api.whatsapp.com/send?text=${msj}`);
    }
</script>
</body>
</html>
